# Subscriptions Service

Тестовое задание в рамках отбора на позицию Junior Golang Developer, октябрь 2025

## Задание

**Задача:** спроектировать и реализовать REST-сервис для агрегации данных об онлайн-подписках пользователей.

**Требования:**
1. Выставить HTTP-ручки для CRUDL-операций над записями о подписках. Каждая запись
содержит:
    * Название сервиса, предоставляющего подписку
    * Стоимость месячной подписки в рублях
    * ID пользователя в формате UUID
    * Дата начала подписки (месяц и год)
    * Опционально дата окончания подписки
2. Выставить HTTP-ручку для подсчета суммарной стоимости всех подписок за выбранный период с фильтрацией по id пользователя и названию подписки
3. СУБД – PostgreSQL. Должны быть миграции для инициализации базы данных
4. Покрыть код логами
5. Вынести конфигурационные данные в .env/.yaml-файл
6. Предоставить swagger-документацию к реализованному API
7. Запуск сервиса с помощью docker-compose

## Реализация

Сервис реализован полностью согласно заданию, а также добавлены:
* Интеграционные тесты для проверки работоспособности сервиса;
* CI-пайплайны GitHub Actions для статического анализа кода и автоматической проверки на тестах;
* Поддержка keyset пагинации для запроса, выводящего список подписок пользователя.

Файл конфигурации сервиса располагается [здесь](config/config.yaml).  

## API

API доступно по адресу ```/api/v1```. Для загрузки Swagger UI в браузере необходимо перейти по пути ```/api/v1/swagger/index.html```.

По умолчанию для клиентских запросов прослушивается порт 8080. Изменить его можно в [файле конфигурации](config/config.yaml) (поле ```http.address```).

## Запуск приложения

Сборка Docker-образа приложения:

```bash
make build_services
```

Развертывание приложения совместно с базой данных:

```bash
make launch_services
```

Развертывание приложения, базы данных и запуск интеграционных тестов:
```bash
make launch_services_with_tests
```

Остановка всех сервисов и удаление контейнеров:

```bash
make stop_services
```

## Примеры запросов

### Запрос на создание подписки

```bash
curl -X 'POST' \
  'http://localhost:8080/api/v1/subs' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "end_date": "07-2029",
  "price": 1000,
  "service_name": "Netflix",
  "start_date": "07-2025",
  "user_id": "37ede82e-f261-4977-866f-7e61eba6e837"
}'
```

Тело ответа:

```
{
  "id": "15ca565c-80ab-4a56-837e-1cc46ab8b7c5",
  "user_id": "37ede82e-f261-4977-866f-7e61eba6e837",
  "service_name": "Netflix",
  "price": 1000,
  "start_date": "07-2025",
  "end_date": "07-2029"
}
```

### Запрос на получение суммарной стоимости о подписках пользователя

```bash
curl -X 'GET' \
  'http://localhost:8080/api/v1/subs/summary?user_id=37ede82e-f261-4977-866f-7e61eba6e837&service_name=Netflix' \
  -H 'accept: application/json'
```

Тело ответа:

```
{
  "user_id": "37ede82e-f261-4977-866f-7e61eba6e837",
  "service_name": "Netflix",
  "total_price": 1000
}
```
